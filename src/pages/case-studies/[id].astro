---
import Layout from "@/layouts/Layout.astro";
import CTABottom from "@/components/CTA.astro";
import { createSEO } from "@/utils/seo";
import { getCollection, render } from "astro:content";
import type { RenderResult } from "astro:content";
import ProjectCarousel from "@/components/ProjectCarousel.tsx";
export const prerender = true;

export async function getStaticPaths() {
  const caseStudies = await getCollection("caseStudies");
  return caseStudies.map((caseStudy) => ({
    params: { id: caseStudy.id },
    props: { caseStudy },
  }));
}

const { caseStudy } = Astro.props;
let rendered: RenderResult | null = null;

if (caseStudy) {
  rendered = await render(caseStudy);
} else {
  console.error("Case study not found");
}

const seo = createSEO({
  pageName: caseStudy.data.title,
  description: caseStudy.data.description,
  pathname: `/case-studies/${caseStudy.id}`,
});

// Define slide data for layaway solution
const layawaySlides = [
  {
    image: "https://images.unsplash.com/photo-1563013544-824ae1b704d3?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&h=600&q=80",
    alt: "Modern dashboard interface with analytics",
    title: "Customer Dashboard",
    description: "Secure passwordless login and payment management interface"
  },
  {
    image: "https://images.unsplash.com/photo-1556742502-ec7c0e9f34b1?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&h=600&q=80",
    alt: "Payment processing and financial technology",
    title: "Payment Integration",
    description: "Stripe + Plaid integration for ACH-based automated payments"
  },
  {
    image: "https://images.unsplash.com/photo-1460925895917-afdab827c52f?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&h=600&q=80",
    alt: "Admin dashboard with charts and analytics",
    title: "Admin Panel",
    description: "Merchant configuration and layaway plan management"
  },
  {
    image: "https://images.unsplash.com/photo-1551434678-e076c223a692?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&h=600&q=80",
    alt: "Mobile app interface showing payment plans",
    title: "Mobile Experience",
    description: "Responsive design for seamless mobile payments"
  },
  {
    image: "https://images.unsplash.com/photo-1554224155-6726b3ff858f?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&h=600&q=80",
    alt: "Security and encryption visualization",
    title: "Security Features",
    description: "Bank-level security with PCI compliance"
  }
];
---

<Layout seo={seo}>
  <div class="min-h-screen bg-background">
    <!-- Hero Section -->
    <section class="pt-40 pb-16 px-4">
      <div class="max-w-6xl mx-auto">
        <div class="fade-in">
          <div class="flex flex-col md:flex-row md:justify-between md:items-start mb-8 gap-6">
            <div>
              <h1 class="text-4xl md:text-6xl font-bold mb-4">{caseStudy.data.title}</h1>
              <p class="text-xl text-primary-600">{caseStudy.data.client}</p>
            </div>
          </div>
          <p class="text-xl text-gray-600 max-w-2xl mb-8">
            {caseStudy.data.description}
          </p>
        </div>
      </div>
    </section>

    <!-- Project Details Section -->
    <section class="py-16 px-4 bg-primary-50">
      <div class="max-w-6xl mx-auto">
        <div class="grid md:grid-cols-3 gap-8">
          <div class="bg-white p-6 rounded-xl shadow-lg text-center fade-in">
            <div class="text-3xl font-bold text-primary-600 mb-2">{caseStudy.data.timeframe}</div>
            <div class="text-gray-600">Project Duration</div>
          </div>
          <div class="bg-white p-6 rounded-xl shadow-lg text-center fade-in">
            <div class="text-3xl font-bold text-primary-600 mb-2">{caseStudy.data.techStack.length}</div>
            <div class="text-gray-600">Technologies Used</div>
          </div>
          <div class="bg-white p-6 rounded-xl shadow-lg text-center fade-in">
            <div class="text-3xl font-bold text-primary-600 mb-2">{caseStudy.data.client}</div>
            <div class="text-gray-600">Client</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Tech Stack Section -->
    <section class="py-16 px-4">
      <div class="max-w-6xl mx-auto">
        <h2 class="text-3xl font-bold text-center mb-12">Technology Stack</h2>
        <div class="flex flex-wrap justify-center gap-4 mb-16">
          {caseStudy.data.techStack.map((tech) => (
            <span class="bg-primary-100 text-primary-800 px-4 py-2 rounded-full font-medium">{tech}</span>
          ))}
        </div>
      </div>
    </section>

    <!-- Project Screenshots Section - Only for layaway-solution -->
    {caseStudy.id === 'layaway-solution' && (
      <section class="py-16 px-4 bg-white">
        <div class="max-w-6xl mx-auto">
          <h2 class="text-3xl font-bold text-center mb-12">Project Screenshots</h2>
          <ProjectCarousel client:load slides={layawaySlides} className="my-8" />
        </div>
      </section>
    )}

    <!-- Content Section -->
    <section class="py-16 px-4 bg-gray-50">
      <div class="max-w-4xl mx-auto">
        <div class="prose prose-lg prose-primary mx-auto fade-in">
          {rendered && <rendered.Content />}
        </div>
      </div>
    </section>

    <CTABottom />
  </div>
</Layout>

<style>
  .fade-in {
    animation: fadeIn 0.8s ease-in-out;
  }

  .fade-in-left {
    animation: fadeInLeft 0.8s ease-in-out;
  }

  .fade-in-right {
    animation: fadeInRight 0.8s ease-in-out;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes fadeInLeft {
    from {
      opacity: 0;
      transform: translateX(-20px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  @keyframes fadeInRight {
    from {
      opacity: 0;
      transform: translateX(20px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }
</style>
