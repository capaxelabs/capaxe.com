---
import Layout from "@/layouts/Layout.astro";
import { siteConfig } from "@/config/site";
import { caseStudiesDetails } from "@/config/caseStudy";
import CTABottom from "@/components/CTA.astro";
import { createSEO } from "@/utils/seo";
import type { SEOProps } from "@/utils/seo";

interface Props {
  seo?: SEOProps;
  title?: string;
  description?: string;
}
const { id } = Astro.params;
const caseStudyDetail = caseStudiesDetails[id as string];

// Handle case when the case study ID doesn't exist
if (!caseStudyDetail) {
  return Astro.redirect("/case-studies");
}

const seo = createSEO({
  pageName: caseStudyDetail.title,
  description: caseStudyDetail.description,
  pathname: `/case-studies/${id}`,
});
---

<Layout seo={seo}>
  <div class="min-h-screen bg-background">
    <!-- Hero Section -->
    <section class="pt-40 pb-16 px-4">
      <div class="max-w-6xl mx-auto">
        <div class="fade-in">
          <div class="flex flex-col md:flex-row md:justify-between md:items-start mb-8 gap-6">
            <div>
              <h1 class="text-4xl md:text-6xl font-bold mb-4">{caseStudyDetail.title}</h1>
              <p class="text-xl text-primary-600">{caseStudyDetail.client}</p>
            </div>
            <a
              href={caseStudyDetail.pdfUrl}
              download
              class="flex items-center gap-2 bg-primary-600 text-white px-4 py-2 rounded-lg hover:bg-primary-700 transition-colors"
            >
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"></path>
              </svg>
              <span>Download PDF</span>
            </a>
          </div>
          <p class="text-xl text-gray-600 max-w-2xl">
            {caseStudyDetail.description}
          </p>
        </div>
      </div>
    </section>

    <!-- Metrics Section -->
    <section class="py-16 px-4 bg-primary-50">
      <div class="max-w-6xl mx-auto">
        <div class="grid md:grid-cols-3 gap-8">
          {
            Object.entries(caseStudyDetail.metrics).map(([key, value]) => (
              <div class="bg-white p-6 rounded-xl shadow-lg text-center fade-in">
                <div class="text-3xl font-bold text-primary-600 mb-2">{value}</div>
                <div class="text-gray-600">{key.replace(/([A-Z])/g, " $1").trim()}</div>
              </div>
            ))
          }
        </div>
      </div>
    </section>

    <!-- Content Sections -->
    <section class="py-16 px-4">
      <div class="max-w-6xl mx-auto">
        <div class="grid md:grid-cols-2 gap-12">
          <div class="fade-in-left">
            <h2 class="text-2xl font-bold mb-6">The Challenge</h2>
            <p class="text-gray-600 whitespace-pre-line mb-8">{caseStudyDetail.challenge}</p>

            <h2 class="text-2xl font-bold mb-6">Our Solution</h2>
            <p class="text-gray-600 whitespace-pre-line mb-8">{caseStudyDetail.solution}</p>

            <h2 class="text-2xl font-bold mb-6">Results</h2>
            <p class="text-gray-600 whitespace-pre-line">{caseStudyDetail.results}</p>
          </div>

          <div class="fade-in-right">
            <div class="bg-primary-50 p-8 rounded-xl mb-8">
              <h2 class="text-2xl font-bold mb-6">Client Testimonial</h2>
              <blockquote class="text-gray-600 italic mb-4">
                &ldquo;{caseStudyDetail.testimonial.quote}&rdquo;
              </blockquote>
              <div class="font-medium">
                <div class="text-primary-600">{caseStudyDetail.testimonial.author}</div>
                <div class="text-gray-500">{caseStudyDetail.testimonial.position}</div>
              </div>
            </div>

            <!-- PDF Preview -->
            <div class="sticky top-24">
              <h2 class="text-2xl font-bold mb-6">Case Study PDF Preview</h2>
              <div class="rounded-xl overflow-hidden shadow-lg">
                <iframe src={caseStudyDetail.pdfUrl} class="w-full h-[600px]" title="PDF Preview"></iframe>
              </div>
              <p class="text-sm text-gray-500 mt-2">
                If the preview doesn't load, <a href={caseStudyDetail.pdfUrl} class="text-primary-600 hover:underline">download the PDF</a> directly.
              </p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <CTABottom />
  </div>
</Layout>

<style>
  .fade-in {
    animation: fadeIn 0.8s ease-in-out;
  }

  .fade-in-left {
    animation: fadeInLeft 0.8s ease-in-out;
  }

  .fade-in-right {
    animation: fadeInRight 0.8s ease-in-out;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes fadeInLeft {
    from {
      opacity: 0;
      transform: translateX(-20px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  @keyframes fadeInRight {
    from {
      opacity: 0;
      transform: translateX(20px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }
</style>
